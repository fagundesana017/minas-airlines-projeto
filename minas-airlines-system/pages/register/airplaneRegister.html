<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Minas Airlines</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="../register/registerStyle.css"/>
    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
</head>
<body>
     <!-- Navbar -->
  <ul class="nav bg-info px-3 py-2">
    <li class="nav-item d-flex align-items-center">
        <img src="../../assets/img/logo.png" style="width: 180px; margin-top: 15px; margin-bottom: 15px; margin-left: 60px;" alt="Minha Imagem">
    </li>
    <li class="nav-item ms-auto">
        <a class="nav-link link-light" href="../all_airplane/airplanePage.html">Aeronaves</a>
    </li>
    <li class="nav-item">
        <a class="nav-link link-light" href="../hangar/hangarPage.html">Hangar</a>
    </li>
    <li class="nav-item d-flex align-items-center">
      <i class="bi bi-broadcast" style="color: rgb(230, 20, 20); margin-right: 5px;"></i>
      <a class="nav-link link-light" href="../monitoring/monitoringPage.html">Monitoramento</a>
    </li>
    <li class="nav-item d-flex align-items-center ms-3">
      <!-- Ícone de perfil com dropdown -->
      <div class="dropdown">
          <a href="#" class="d-flex align-items-center justify-content-center bg-light rounded-circle" style="width: 40px; height: 40px;" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person" style="font-size: 1.5rem; color: #1E234B;"></i>
          </a>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
              <!-- <li><a class="dropdown-item" href="#">Perfil</a></li>
              <li><a class="dropdown-item" href="#">Configurações</a></li> -->
              <li><a class="dropdown-item" href="../../index.html">Sair</a></li>
          </ul>
      </div>
  </li>
</ul>
    

    <div class="main">
        <div class="nav-register d-flex align-items-center">
            <a href="../all_airplane/airplanePage.html" style="color: rgb(65, 65, 65);"><i class="bi bi-arrow-left" style="font-size: 35px; margin-right: 20px; cursor: pointer;"></i></a>
            <h1>Nova aeronave</h1>
        </div>
        <form class="row g-3">
            <div class="col-md-6">
                <label for="matricula" class="form-label">Matrícula</label>
                <input type="text" class="form-control" id="matricula" placeholder="Informe a matrícula">
            </div>
            <div class="col-md-6">
                <label for="numeroVoo" class="form-label">Número do voo</label>
                <input type="text" class="form-control" id="numeroVoo" placeholder="Informe o número do voo">
            </div>
            <div class="col-12">
                <label for="modelo" class="form-label">Modelo</label>
                <input type="text" class="form-control" id="modelo" placeholder="Informe o modelo">
            </div>
            <div class="col-6">
                <label for="procedencia" class="form-label">Procedência</label>
                <input type="text" class="form-control" id="procedencia" placeholder="Informe a procedência">
            </div>
            <div class="col-md-6">
                <label for="destino" class="form-label">Destino</label>
                <input type="text" class="form-control" id="destino" placeholder="Informe o destino">
            </div>
            <div class="col-md-6">
                <label for="numeroPassageiros" class="form-label">Número de passageiro</label>
                <input type="text" class="form-control" id="numeroPassageiros"  placeholder="Informe a quantidade de passageiros">
            </div>
            <div class="col-md-6">
                <label for="hangar" class="form-label">Hangar</label>
                <select id="hangar" class="form-select">
                 
                </select>
              </div>
        </form>
        <div class="d-flex justify-content-end mt-3">
            <button type="button" class="btn2 me-2" data-bs-toggle="modal" data-bs-target="#cancelModal">Cancelar</button>
            <button id="btnCadastrar" type="button" class="btn" onclick="cadastroAeronave()">Cadastrar</button>
        </div>
    </div>

    <div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cancelModalLabel">Cancelar cadastro</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <i class="bi bi-exclamation-circle" style="color: rgb(252, 210, 25); margin-right: 10px; "></i>
                    Tem certeza de que deseja cancelar o cadastro?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn2" data-bs-dismiss="modal">Não</button>
                    <button type="button" class="btn btn-danger" onclick="window.location.href='../all_airplane/airplanePage.html';">Sim, cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 9999; justify-content: center; align-items: center;">
        <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script> 
        <dotlottie-player src="https://lottie.host/a14cc146-51da-4447-bd9c-d897771a5be8/GZKdABYKQr.json" background="transparent" speed="1" style="width: 140px; height: 140px;" loop autoplay></dotlottie-player>    
    </div>

    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
          <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>

     
    <footer>
        <p style="margin-top: 10px; font-size: 14px;">&copy; 2024 Minas Airlines. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
   
    <script>
        function showSpinner() {
            const overlay = document.getElementById("overlay");
            overlay.style.display = "flex";

            setTimeout(() => {
                overlay.style.display = "none";
                window.location.href='../all_airplane/airplanePage.html';

            }, 10000);
        }
    </script>

<script>
    // Função para buscar hangares cadastrados
    async function fetchHangars() {
        const user = localStorage.getItem("user");
        const password = localStorage.getItem("password");

        if (user && password) {
            const basicAuth = btoa(`${user}:${password}`);

            try {
                const response = await fetch("https://a3-airport-midm.onrender.com/hangars/", {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Basic ${basicAuth}`,
                    },
                });

                if (!response.ok) {
                    throw new Error(`Erro: ${response.status} - ${response.statusText}`);
                }

                const hangars = await response.json();

                // Preencher o select com os hangares
                const hangarSelect = document.getElementById("hangar");
                hangarSelect.innerHTML = '';  // Limpar o select antes de adicionar as opções

                // Adicionar uma opção padrão
                const defaultOption = document.createElement("option");
                defaultOption.textContent = "Escolha um hangar";
                hangarSelect.appendChild(defaultOption);

                // Adicionar os hangares ao select
                hangars.forEach(hangar => {
                    const option = document.createElement("option");
                    option.value = hangar.id; // Usar o ID do hangar como valor
                    option.textContent = hangar.nome; // Supondo que 'name' seja o nome do hangar
                    hangarSelect.appendChild(option);
                });

            } catch (error) {
                console.error(error);
                alert(`Erro ao carregar os hangares: ${error.message}`);
            }
        }
    }

    // Chamar a função para carregar os hangares quando a página for carregada
    window.onload = fetchHangars;
</script>

<script>
    
    async function cadastroAeronave() {
        console.log('Cadatrado')
        // Pegando os valores dos campos do formulário
        const matricula = document.getElementById("matricula").value;
        const numeroVoo = document.getElementById("numeroVoo").value;
        const modelo = document.getElementById("modelo").value;
        const procedencia = document.getElementById("procedencia").value;
        const destino = document.getElementById("destino").value;
        const numeroPassageiros = document.getElementById("numeroPassageiros").value;
        const hangarId = document.getElementById("hangar").value;

        // Validando os campos
        if (!matricula || !numeroVoo || !modelo || !procedencia || !destino || !numeroPassageiros || !hangarId) {
            alert("Por favor, preencha todos os campos.");
            return;
        }

        // Exibindo o overlay de carregamento
        document.getElementById("overlay").style.display = "flex";

        // Definindo o objeto com os dados da aeronave
        const airplaneData = {
            matricula,
            numero_Voo: numeroVoo,
            modelo,
            procedencia,
            destino,
            numero_passageiros: numeroPassageiros,
            hangar: hangarId
        };

        try {
            const user = localStorage.getItem("user");
            const password = localStorage.getItem("password");

            if (user && password) {
                const basicAuth = btoa(`${user}:${password}`);

                // Enviando os dados para a API para cadastrar a aeronave
                const response = await fetch("https://a3-airport-midm.onrender.com/airplanes/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Basic ${basicAuth}`,
                    },
                    body: JSON.stringify(airplaneData),
                });

                if (response.ok) {
                    showMessageRegister("Aeronave cadastrada com sucesso!", "success");
                    setTimeout(() => {
                        window.location.href = '../all_airplane/airplanePage.html';
                    }, 1000);
                } else {
                    const error = await response.json();
                    showMessageRegister("Erro ao cadastrar aeronave: " + error.detail, "error");
                }
            }
        } catch (error) {
            console.error(error);
            alert(`Erro ao cadastrar a aeronave: ${error.message}`);
            document.getElementById("overlay").style.display = "none";
        }
    }

    
function showMessageRegister(message, type) {
    const messageDiv = document.createElement("div");
    messageDiv.textContent = message;
    
    if (type === "success") {
        messageDiv.style.backgroundColor = "green";
        messageDiv.style.color = "white";
    } else if (type === "error") {
        messageDiv.style.backgroundColor = "red";
        messageDiv.style.color = "white";
    }
    
    messageDiv.style.position = "fixed";
    messageDiv.style.top = "20px";
    messageDiv.style.left = "50%";
    messageDiv.style.transform = "translateX(-50%)";
    messageDiv.style.padding = "10px 20px";
    messageDiv.style.borderRadius = "5px";
    messageDiv.style.zIndex = "1000";

    document.body.appendChild(messageDiv);

    setTimeout(() => {
        messageDiv.remove();
    }, 3000);
}
</script>
<script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
<script>
  new window.VLibras.Widget('https://vlibras.gov.br/app');
</script>
</body>
</html>

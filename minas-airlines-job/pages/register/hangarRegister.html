<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Minas Airlines</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="../register/registerStyle.css"/>
    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
</head>
<body>
     <!-- Navbar -->
  <ul class="nav bg-info px-3 py-2">
    <li class="nav-item d-flex align-items-center">
        <img src="../../assets/img/logo.png" style="width: 180px; margin-top: 15px; margin-bottom: 15px; margin-left: 60px;" alt="Minha Imagem">
    </li>
    <li class="nav-item ms-auto">
        <a class="nav-link link-light" href="../all_airplane/airplanePage.html">Aeronaves</a>
    </li>
    <li class="nav-item">
        <a class="nav-link link-light" href="../hangar/hangarPage.html">Hangar</a>
    </li>
    <li class="nav-item d-flex align-items-center">
      <i class="bi bi-broadcast" style="color: rgb(230, 20, 20); margin-right: 5px;"></i>
      <a class="nav-link link-light" href="../monitoring/monitoringPage.html">Monitoramento</a>
    </li>
    <li class="nav-item d-flex align-items-center ms-3">
      <!-- Ícone de perfil com dropdown -->
      <div class="dropdown">
          <a href="#" class="d-flex align-items-center justify-content-center bg-light rounded-circle" style="width: 40px; height: 40px;" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person" style="font-size: 1.5rem; color: #1E234B;"></i>
          </a>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
              <!-- <li><a class="dropdown-item" href="#">Perfil</a></li>
              <li><a class="dropdown-item" href="#">Configurações</a></li> -->
              <li><a class="dropdown-item" href="../../index.html">Sair</a></li>
          </ul>
      </div>
  </li>
</ul>
    

    <div class="main">
        <div class="nav-register d-flex align-items-center">
            <a href="../hangar/hangarPage.html" style="color: rgb(65, 65, 65);"><i class="bi bi-arrow-left" style="font-size: 35px; margin-right: 20px; cursor: pointer;"></i></a>
            <h1>Novo hangar</h1>
        </div>
        <form class="row g-3">
            <div class="col-md-6">
                <label for="codigo" class="form-label">Código</label>
                <input type="text" class="form-control" id="codigo" placeholder="Informe o cód.">
            </div>
            <div class="col-md-6">
                <label for="nome" class="form-label">Nome</label>
                <input type="text" class="form-control" id="nome" placeholder="Informe o nome do hangar">
            </div>
           <!-- Campo Tipo no formulário -->
            <div class="col-md-6">
                <label for="tipo" class="form-label">Tipo</label>
                <select id="tipo" class="form-select">
                    <!-- As opções de tipos de hangar serão preenchidas aqui -->
                </select>
            </div>

            <div class="col-6">
                <label for="capacidade_maxima" class="form-label">Capacidade máxima</label>
                <input type="text" class="form-control" id="capacidade_maxima" placeholder="Informe o modelo">
            </div>
            <div class="col-6">
                <label for="localizacao" class="form-label">Localização</label>
                <input type="text" class="form-control" id="localizacao" placeholder="Informe a localização">
            </div>
          
        </form>
        <div class="d-flex justify-content-end mt-3">
            <button type="button" class="btn2 me-2" data-bs-toggle="modal" data-bs-target="#cancelModal">Cancelar</button>
            <button type="button" class="btn btn-primary" id="btnCadastrar" disabled>Cadastrar</button>
        </div>
    </div>

    <div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cancelModalLabel">Cancelar edição</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <i class="bi bi-exclamation-circle" style="color: rgb(252, 210, 25); margin-right: 10px; "></i>
                    Tem certeza de que deseja cancelar o cadastro?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn2" data-bs-dismiss="modal">Não</button>
                    <button type="button" class="btn btn-danger" onclick="window.location.href='../hangar/hangarPage.html';">Sim, cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 9999; justify-content: center; align-items: center;">
        <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script> 
        <dotlottie-player src="https://lottie.host/a14cc146-51da-4447-bd9c-d897771a5be8/GZKdABYKQr.json" background="transparent" speed="1" style="width: 140px; height: 140px;" loop autoplay></dotlottie-player>    
    </div>

    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
          <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>

    <!-- Modal de Sucesso -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="successModalLabel">Cadastro realizado com sucesso!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <i class="bi bi-check-circle" style="color: green; font-size: 1rem;"></i>
                    Hangar foi cadastrada com sucesso.
                </div>
            </div>
        </div>
    </div>
     
    <footer>
        <p style="margin-top: 10px; font-size: 14px;">&copy; 2024 Minas Airlines. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
    
    <script>
        function showSpinner() {
            const overlay = document.getElementById("overlay");
            overlay.style.display = "flex";

            setTimeout(() => {
                overlay.style.display = "none";
                window.location.href='../hangar/hangarPage.html';
            }, 3000);
        }
    </script>

<script>
    function validarFormulario() {
        // Selecionar os campos do formulário
        const codigo = document.getElementById("codigo").value.trim();
        const nome = document.getElementById("nome").value.trim();
        const tipo = document.getElementById("tipo").value.trim();
        const capacidade_maxima = document.getElementById("capacidade_maxima").value.trim();
        const localizacao = document.getElementById("localizacao").value.trim();
    
        // Verificar se todos os campos obrigatórios estão preenchidos
        const formularioValido = codigo && nome && tipo && capacidade_maxima && localizacao;
    
        // Habilitar ou desabilitar o botão com base na validação
        document.getElementById("btnCadastrar").disabled = !formularioValido;
    }
    
    // Adicionar event listeners para monitorar mudanças nos campos do formulário
    document.querySelectorAll("#codigo, #nome, #tipo, #capacidade_maxima, #localizacao").forEach(campo => {
        campo.addEventListener("input", validarFormulario);
    });
    
    // Chamar a função ao carregar a página para garantir o estado correto do botão
    window.onload = validarFormulario;
    </script>
<script>
// Função de cadastro do Hangar
async function cadastroHangar() {
    const codigo = document.getElementById("codigo").value;
    const nome = document.getElementById("nome").value;
    const tipo = document.getElementById("tipo").value;
    const capacidade_maxima = document.getElementById("capacidade_maxima").value;
    const localizacao = document.getElementById("localizacao").value;

    const hangarData = {
        codigo: codigo,
        nome: nome,
        tipo: tipo,
        capacidade_maxima: parseInt(capacidade_maxima),
        localizacao: localizacao
    };

    try {
        // Requisição POST para cadastrar o hangar
        const response = await fetch("https://a3-airport-midm.onrender.com/hangars/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Basic " + btoa(localStorage.getItem("user") + ":" + localStorage.getItem("password"))
            },
            body: JSON.stringify(hangarData)
        });

        if (response.ok) {
            const result = await response.json();
            console.log("Hangar cadastrado:", result);

            const modal = new bootstrap.Modal(document.getElementById('successModal'));
            modal.show();

            setTimeout(() => {
                window.location.href = '../hangar/hangarPage.html';
            }, 7000);  // 3000ms = 3 segundos
        } else {
            const error = await response.json();
            alert(error.detail || "Ocorreu um erro ao tentar cadastrar o hangar.");
        }
    } catch (error) {
        console.error("Erro na requisição:", error);
        alert("Ocorreu um erro ao tentar cadastrar o hangar.");
    }
}

// Evento de clique no botão de cadastrar
document.getElementById("btnCadastrar").addEventListener("click", function() {
    cadastroHangar();
});

</script>
<script>
    async function fetchHangars() {
    const user = localStorage.getItem("user");
    const password = localStorage.getItem("password");

    if (user && password) {
        const basicAuth = btoa(`${user}:${password}`);

        try {
            const response = await fetch("https://a3-airport-midm.onrender.com/hangars/", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Basic ${basicAuth}`,
                },
            });

            if (!response.ok) {
                throw new Error(`Erro: ${response.status} - ${response.statusText}`);
            }

            const hangars = await response.json();

            // Preencher o select com os tipos de hangar
            const hangarSelect = document.getElementById("tipo");
            hangarSelect.innerHTML = '';  // Limpar o select antes de adicionar as opções

            // Adicionar uma opção padrão para tipos
            const defaultOption = document.createElement("option");
            defaultOption.textContent = "Escolha um tipo de hangar";
            hangarSelect.appendChild(defaultOption);

            // Tipos de hangar (de acordo com a classe Hangar)
            const tipos = [
                { value: 'P', label: 'Pequeno' },
                { value: 'M', label: 'Médio' },
                { value: 'G', label: 'Grande' }
            ];

            // Adicionar os tipos de hangar ao select
            tipos.forEach(tipo => {
                const option = document.createElement("option");
                option.value = tipo.value;  // Usar o valor da constante (P, M, G)
                option.textContent = tipo.label;  // Usar o nome do tipo (Pequeno, Médio, Grande)
                hangarSelect.appendChild(option);
            });          

        } catch (error) {
            console.error(error);
            alert(`Erro ao carregar os hangares: ${error.message}`);
        }
    }
}

// Chamar a função para carregar os hangares e tipos de hangar quando a página for carregada
window.onload = fetchHangars;
</script>
<script>
    // Função de logout
function logout() {
    localStorage.removeItem("user");
    localStorage.removeItem("password");
    window.location.href = 'login.html';
}
</script>
<script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
      new window.VLibras.Widget('https://vlibras.gov.br/app');
    </script>
</body>
</html>
